#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Customize to your needs...
unsetopt CORRECT

# aliases
alias python='python3'
alias assume='source assume'
alias lsi="ls -l $HOME/Documents/obsidian/Inbox"
alias k='kubectl'
alias tf='terraform'
alias dkc='docker compose'

# direnv
eval "$(direnv hook zsh)"

# Claude Code runs commands in shells that source zshrc but never
# enter a prompt loop, so precmd (where direnv hook fires) never
# triggers. Force an immediate export so .envrc vars are available.
if [[ -n "$CLAUDECODE" ]]; then
  eval "$(DIRENV_LOG_FORMAT= direnv export zsh)"
fi

#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
export SDKMAN_DIR="$HOME/.sdkman"
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"
eval "$(pyenv init --path)"

# function iterm2_print_user_vars() {
#   iterm2_set_user_var kubecontext $(kubectl config current-context):$(kubectl config view --minify --output 'jsonpath={..namespace}')
# }

test -e "$HOME/.iterm2_shell_integration.zsh" && source "$HOME/.iterm2_shell_integration.zsh" || true

autoload -Uz compinit
if [ "$(whoami)" = "zpearce" ]; then
  compinit -i
else
  compinit
fi

[[ -s "$HOME/.gvm/scripts/gvm" ]] && source "$HOME/.gvm/scripts/gvm"

bindkey '^R' history-incremental-pattern-search-backward

export NVM_DIR="$HOME/.nvm"
[ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && \. "/opt/homebrew/opt/nvm/nvm.sh"
[ -s "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm" ] && \. "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm"

# Machine-specific overrides
[[ -s "$HOME/.zshrc.local" ]] && source "$HOME/.zshrc.local"
